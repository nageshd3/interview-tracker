<div class="interview-list-container">
  <h1>Interview Management</h1>

  @if (error()) {
    <mat-card class="error-card">
      <mat-card-content>
        <p class="error-message">{{ error() }}</p>
      </mat-card-content>
    </mat-card>
  }

  <form
    [formGroup]="interviewForm"
    (ngSubmit)="addInterview()"
    aria-labelledby="add-interview-title"
    class="add-interview-form"
  >
    <h2 id="add-interview-title">Add New Interview</h2>

    <!-- Company -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Company</mat-label>

      <input
        matInput
        formControlName="company"
        aria-required="true"
        aria-describedby="company-error"
      />

      @if (company?.invalid && company?.touched) {
        <mat-error id="company-error">
          @if (company?.hasError('required')) {
            Company name is required
          } @else if (company?.hasError('minLengthTrimmed')) {
            Company name must be at least 2 characters
          }
        </mat-error>
      }
    </mat-form-field>

    <!-- Role -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Role</mat-label>

      <input matInput formControlName="role" aria-required="true" aria-describedby="role-error" />

      @if (role?.invalid && role?.touched) {
        <mat-error id="role-error">
          @if (role?.hasError('required')) {
            Role is required
          } @else if (role?.hasError('minLengthTrimmed')) {
            Role must be at least 2 characters
          }
        </mat-error>
      }
    </mat-form-field>

    <!-- Date -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Interview Date</mat-label>

      <input
        matInput
        type="date"
        formControlName="date"
        aria-required="true"
        aria-describedby="date-error"
        [min]="today"
      />

      @if (date?.invalid && date?.touched) {
        <mat-error id="date-error">
          @if (date?.hasError('required')) {
            Interview date is required
          } @else if (date?.hasError('invalidDate')) {
            Invalid date format
          } @else if (date?.hasError('pastDate')) {
            Interview date cannot be in the past
          }
        </mat-error>
      }
    </mat-form-field>

    <button
      mat-raised-button
      color="primary"
      type="submit"
      [disabled]="interviewForm.invalid || isSubmitting"
      class="submit-btn"
    >
      @if (!isSubmitting) {
        <ng-container>
          <mat-icon>add</mat-icon>
          Add Interview
        </ng-container>
      } @else {
        <mat-spinner diameter="20"></mat-spinner>
      }
    </button>
  </form>

  <!-- Filters Section -->
  <mat-card class="filters-card">
    <h3>Search & Filter</h3>
    <mat-card-content>
      <div class="filters-row">
        <!-- Status Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Status</mat-label>
          <mat-select [value]="statusFilter()" (selectionChange)="updateStatusFilter($event.value)">
            <mat-option value="All">All</mat-option>
            <mat-option value="Scheduled">Scheduled</mat-option>
            <mat-option value="Completed">Completed</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Company Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Company</mat-label>
          <input
            matInput
            [value]="companyFilter()"
            (input)="updateCompanyFilter($event)"
            placeholder="Filter by company"
          />
        </mat-form-field>

        <!-- Search Term -->
        <mat-form-field appearance="outline">
          <mat-label>Search</mat-label>
          <input
            matInput
            [value]="searchTerm()"
            (input)="updateSearchTerm($event)"
            placeholder="Search company or role"
          />
        </mat-form-field>

        <!-- Clear Filters -->
        <button mat-stroked-button (click)="clearFilters()">
          <ng-container>
            <mat-icon>clear</mat-icon>
            Clear Filters
          </ng-container>
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Interviews List -->
  <section class="interviews-section">
    <h2>Your Interviews ({{ total() }})</h2>

    @if (filteredInterviews().length > 0) {
      <div class="interviews-grid">
        @for (interview of filteredInterviews(); track interview.id) {
          <mat-card class="interview-card" [routerLink]="['/interviews', interview.id]">
            <mat-card-header>
              <h3>{{ interview.company }}</h3>
              <p class="role">{{ interview.role }}</p>
              <p class="date">{{ interview.date }}</p>
              <span class="status" [ngClass]="'status-' + interview.status.toLowerCase()">{{
                interview.status
              }}</span>
            </mat-card-header>
            <mat-card-content>
              @if (interview.notes) {
                <p>{{ interview.notes }}</p>
              } @else {
                <p class="muted">No notes added</p>
              }
            </mat-card-content>
            <mat-card-actions>
              <button mat-button color="primary">View Details</button>
            </mat-card-actions>
          </mat-card>
        }
      </div>
    } @else {
      <div class="empty-state">
        <mat-icon
          style="font-size: 48px; width: 48px; height: 48px; color: #bbb; margin-bottom: 16px"
          >event_busy</mat-icon
        >
        <p>No interviews found matching your filters.</p>
        <p style="font-size: 0.9rem; color: #bbb">Add your first interview to get started!</p>
      </div>
    }
  </section>
</div>
